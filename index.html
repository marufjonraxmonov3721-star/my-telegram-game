<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Clicker Game</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.x.x/firebase-database-compat.js"></script>

    <style>
        :root { --main-color: #f39c12; --bg-color: #0f0f0f; }
        body { background: var(--bg-color); color: white; font-family: 'Segoe UI', sans-serif; text-align: center; margin: 0; overflow-x: hidden; }
        
        .header { padding: 30px 20px; background: linear-gradient(0deg, transparent, #1a1a1a); }
        #user-score { font-size: 50px; font-weight: bold; color: var(--main-color); text-shadow: 0 0 20px rgba(243, 156, 18, 0.5); }
        
        .coin-container { margin: 40px auto; position: relative; width: 220px; height: 220px; }
        .coin { width: 100%; cursor: pointer; transition: transform 0.1s; filter: drop-shadow(0 0 15px var(--main-color)); }
        .coin:active { transform: scale(0.9); }

        .ai-assistant { background: #1e1e1e; margin: 20px; padding: 15px; border-radius: 20px; border: 1px solid #333; display: flex; align-items: center; gap: 15px; }
        .ai-img { width: 50px; border-radius: 50%; border: 2px solid var(--main-color); }
        #ai-text { font-size: 14px; text-align: left; color: #bbb; margin: 0; }

        .leaderboard { background: #1a1a1a; margin: 20px; border-radius: 20px; padding: 20px; }
        .user-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #222; font-size: 14px; }
        .rank { color: var(--main-color); font-weight: bold; margin-right: 10px; }
    </style>
</head>
<body>

    <div class="header">
        <div>HISOBINGIZ</div>
        <div id="user-score">0</div>
    </div>

    <div class="coin-container">
        <img src="https://cdn-icons-png.flaticon.com/512/5968/5968260.png" class="coin" onclick="handleTap(event)">
    </div>

    <div class="ai-assistant" onclick="askAI()">
        <img src="https://cdn-icons-png.flaticon.com/512/4712/4712035.png" class="ai-img">
        <div>
            <b style="font-size: 12px; color: var(--main-color);">AI YORDAMCHI (Yordam uchun bosing)</b>
            <p id="ai-text">Salom! Men sening strategingman. Ballar yig'ishda yordam beraman!</p>
        </div>
    </div>

    <div class="leaderboard">
        <h3>üèÜ TOP O'YINCHILAR</h3>
        <div id="leaderboard-list">Yuklanmoqda...</div>
    </div>

    <script>
        // 1. FIREBASE SOZLAMALARI
        const firebaseConfig = {
            apiKey: "AIzaSyBc7tUey3q6hGZjWxisJo701-G4NbyD9zI",
            authDomain: "gen-lang-client-0228947349.firebaseapp.com",
            projectId: "gen-lang-client-0228947349",
            databaseURL: "https://gen-lang-client-0228947349-default-rtdb.firebaseio.com", // Database URL ni o'zingizniki bilan tekshiring
            storageBucket: "gen-lang-client-0228947349.firebasestorage.app",
            messagingSenderId: "253793341504",
            appId: "1:253793341504:web:709752258000dab44fcfa5"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 2. TELEGRAM MA'LUMOTLARI
        const tg = window.Telegram.WebApp;
        tg.expand();
        const userId = tg.initDataUnsafe.user?.id || "guest_" + Math.floor(Math.random() * 1000);
        const userName = tg.initDataUnsafe.user?.first_name || "O'yinchi";

        let currentScore = 0;

        // 3. FOYDALANUVCHINI YUKLASH VA SINXRONLASH
        const userRef = db.ref('users/' + userId);
        userRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                currentScore = data.score;
                document.getElementById('user-score').innerText = currentScore.toLocaleString();
            } else {
                userRef.set({ name: userName, score: 0 });
            }
        });

        // 4. TAP FUNKSIYASI
        function handleTap(event) {
            currentScore += 1;
            document.getElementById('user-score').innerText = currentScore.toLocaleString();
            userRef.update({ score: currentScore });
            
            if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
        }

        // 5. REYTING TIZIMI (TOP 10)
        const leaderboardRef = db.ref('users').orderByChild('score').limitToLast(10);
        leaderboardRef.on('value', (snapshot) => {
            const listDiv = document.getElementById('leaderboard-list');
            listDiv.innerHTML = '';
            let players = [];
            snapshot.forEach(child => { players.push(child.val()); });
            players.reverse().forEach((player, index) => {
                listDiv.innerHTML += `
                    <div class="user-row">
                        <span><span class="rank">#${index + 1}</span> ${player.name}</span>
                        <span>${player.score.toLocaleString()}</span>
                    </div>`;
            });
        });

        // 6. AI YORDAMCHI (SODDALASHTIRILGAN AI MANTIQI)
        function askAI() {
            const aiText = document.getElementById('ai-text');
            const tips = [
                `Zo'r ketyapsan, ${userName}! Yana 100 ta bossang, reytinging ko'tariladi!`,
                "Barmog'ing charchamadimi? Ozgina dam ol va yana qayt!",
                "Bilasanmi, eng ko'p ball to'plaganlar haftasiga sovrin olishadi!",
                "Strategiya: Tezgina bosish ballarni tezroq ko'paytiradi!",
                `Hozirgi baling: ${currentScore}. Rekord o'rnatishga yaqin qolding!`
            ];
            const randomTip = tips[Math.floor(Math.random() * tips.length)];
            aiText.innerText = randomTip;
        }
    </script>
</body>
</html>
