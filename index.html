<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EMPEROR OS: Ultimate Control</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root { --gold: #ffd700; --bg: #05070a; --card: #111418; --green: #00ff88; --red: #ff3e3e; --blue: #3e86ff; }
        body { background-color: var(--bg); color: #e0e0e0; font-family: 'Consolas', monospace; margin: 0; height: 100vh; overflow: hidden; }
        
        /* Terminal UI Style */
        .header { padding: 10px; border-bottom: 1px solid #222; background: rgba(0,0,0,0.5); display: flex; justify-content: space-between; align-items: center; }
        #score { font-size: 32px; color: var(--gold); font-weight: bold; }
        .stat-box { font-size: 10px; color: var(--blue); }

        .main-display { flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        .tap-circle { width: 220px; height: 220px; background: url('https://cdn-icons-png.flaticon.com/512/1490/1490900.png') no-repeat center; background-size: contain; filter: drop-shadow(0 0 20px rgba(255,215,0,0.2)); cursor: pointer; transition: 0.05s; }
        .tap-circle:active { transform: scale(0.92); }

        /* Bottom Menu */
        .dock { width: 100%; background: var(--card); display: grid; grid-template-columns: repeat(5, 1fr); padding: 10px 0; border-top: 1px solid #333; }
        .dock-item { text-align: center; font-size: 10px; cursor: pointer; color: #888; }
        .dock-item.active { color: var(--gold); }
        .dock-item i { font-size: 20px; display: block; margin-bottom: 3px; }

        /* Advanced Modals */
        .glass-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 1000; display: none; flex-direction: column; }
        .modal-body { flex-grow: 1; padding: 20px; overflow-y: auto; }
        .close-bar { padding: 10px; text-align: right; border-bottom: 1px solid #222; }

        /* Admin Dashboard */
        .admin-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .admin-card { background: #1a1e23; border: 1px solid #333; padding: 10px; border-radius: 5px; }
        .admin-card h5 { margin: 0 0 8px 0; color: var(--gold); font-size: 11px; text-transform: uppercase; }
        input, select, textarea { width: 100%; background: #000; border: 1px solid #444; color: var(--green); padding: 8px; font-size: 12px; margin-bottom: 5px; }
        .btn-cmd { background: var(--gold); border: none; padding: 8px; width: 100%; font-weight: bold; cursor: pointer; font-size: 10px; }
        .btn-danger { background: var(--red); color: white; }

        /* Logs */
        .log-line { font-size: 9px; border-bottom: 1px solid #111; padding: 4px 0; color: #aaa; }
        .log-alert { color: var(--red); font-weight: bold; }
    </style>
</head>
<body>

    <div class="header">
        <div class="stat-box">SYS_VER: 4.0.1<br>STATUS: ENCRYPTED</div>
        <div id="score">0.00</div>
        <div class="stat-box" style="text-align:right">PING: <span id="ping">24</span>ms<br>USR_ID: <span id="usr-id">0</span></div>
    </div>

    <div class="main-display">
        <div class="tap-circle" id="tapBtn"></div>
        <div id="jackpot-info" style="position:absolute; top:20px; color:var(--gold); font-size:12px;">JACKPOT: <span id="jp-sum">0</span></div>
    </div>

    <div class="dock">
        <div class="dock-item" onclick="openP('profile')"><i>üë§</i>PROFIL</div>
        <div class="dock-item" onclick="openP('mining')"><i>‚ö°</i>MINING</div>
        <div class="dock-item" onclick="openP('market')"><i>üõí</i>BOZOR</div>
        <div class="dock-item" onclick="openP('admin')" id="adm-nav" style="display:none"><i>üíÄ</i>ROOT</div>
        <div class="dock-item" onclick="openP('promo')"><i>üéüÔ∏è</i>PROMO</div>
    </div>

    <div id="master-modal" class="glass-modal">
        <div class="close-bar"><span onclick="closeP()" style="cursor:pointer; padding:10px; border:1px solid #444;">[ EXIT_SYSTEM ]</span></div>
        <div class="modal-body" id="modal-content"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBc7tUey3q6hGZjWxisJo701-G4NbyD9zI",
            authDomain: "gen-lang-client-0228947349.firebaseapp.com",
            projectId: "gen-lang-client-0228947349",
            databaseURL: "https://gen-lang-client-0228947349-default-rtdb.firebaseio.com",
            storageBucket: "gen-lang-client-0228947349.firebasestorage.app",
            messagingSenderId: "253793341504",
            appId: "1:253793341504:web:709752258000dab44fcfa5"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const tg = window.Telegram.WebApp;
        tg.expand();

        const ADMIN_ID = 7385372033;
        const tgUser = tg.initDataUnsafe?.user || { id: 9999, first_name: "DEV_MODE" };
        const userRef = db.ref('users/' + tgUser.id);
        
        let score = 0, userData = null, clickPower = 1;

        if(tgUser.id == ADMIN_ID) document.getElementById('adm-nav').style.display = 'block';
        document.getElementById('usr-id').innerText = tgUser.id;

        // System Initialization
        userRef.on('value', snap => {
            userData = snap.val();
            if(!userData) {
                userRef.set({
                    id: tgUser.id, name: tgUser.first_name, score: 0, 
                    reputation: 100, level: 1, regDate: Date.now(), 
                    mining: 0, lastSeen: Date.now()
                });
            } else {
                if(userData.banned) document.body.innerHTML = "<h1 style='color:red; text-align:center; padding-top:20%'>SYSTEM ACCESS DENIED: BANNED</h1>";
                score = userData.score;
                document.getElementById('score').innerText = Math.floor(score).toLocaleString();
            }
        });

        // Jackpot Tracker
        db.ref('economy/jackpot').on('value', s => document.getElementById('jp-sum').innerText = Math.floor(s.val() || 0).toLocaleString());

        // Tap Engine with Transaction
        document.getElementById('tapBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            userRef.child('score').transaction(current => (current || 0) + clickPower);
            db.ref('economy/jackpot').transaction(jp => (jp || 0) + 0.01);
            if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
        });

        function openP(type) {
            const modal = document.getElementById('master-modal');
            const content = document.getElementById('modal-content');
            modal.style.display = 'flex';
            content.innerHTML = 'Executing query...';

            if(type === 'admin') {
                content.innerHTML = `
                    <div class="admin-grid">
                        <div class="admin-card">
                            <h5>üì¢ Global Broadcast</h5>
                            <textarea id="broad-msg" placeholder="Terminal message..."></textarea>
                            <button class="btn-cmd" onclick="cmdBroad()">EXECUTE</button>
                        </div>
                        <div class="admin-card">
                            <h5>üïµÔ∏è Deep Inspect</h5>
                            <input id="target-id" placeholder="User ID">
                            <button class="btn-cmd" onclick="cmdInspect()">SEARCH_DB</button>
                        </div>
                        <div class="admin-card">
                            <h5>‚öñÔ∏è Economy Settings</h5>
                            <button class="btn-cmd" onclick="cmdSeason()">SEASON_RESET</button>
                            <button class="btn-cmd btn-danger" onclick="cmdKillJP()">ERASE_JACKPOT</button>
                        </div>
                        <div class="admin-card">
                            <h5>üéüÔ∏è Promo Gen</h5>
                            <input id="p-code" placeholder="CODE">
                            <input id="p-val" placeholder="VALUE">
                            <button class="btn-cmd" onclick="cmdPromo()">CREATE_KEY</button>
                        </div>
                    </div>
                    <div id="adm-log-box" style="margin-top:15px; background:#000; padding:10px; height:200px; overflow-y:auto;">
                        <div class="log-line">--- SYSTEM LOGS LOADED ---</div>
                    </div>
                `;
                loadAdminLogs();
            } else if(type === 'profile') {
                content.innerHTML = `
                    <div class="admin-card">
                        <h5>USER_DOSSIER</h5>
                        <p>NAME: ${userData.name}</p>
                        <p>ID: ${userData.id}</p>
                        <p>REPUTATION: ${userData.reputation}%</p>
                        <p>REG_DATE: ${new Date(userData.regDate).toLocaleDateString()}</p>
                        <button class="btn-cmd" onclick="copyId()">COPY_ID_TOKEN</button>
                    </div>
                `;
            }
        }

        // --- ADMIN LOGIC ---
        function cmdBroad() {
            const m = document.getElementById('broad-msg').value;
            db.ref('system/broadcast').set({ msg: m, time: Date.now() });
        }

        function cmdInspect() {
            const id = document.getElementById('target-id').value;
            db.ref('users/' + id).once('value', s => {
                const d = s.val();
                if(!d) return alert("NO_DATA_FOUND");
                alert(`USER: ${d.name}\nSCORE: ${d.score}\nREP: ${d.reputation}`);
            });
        }

        function loadAdminLogs() {
            db.ref('violations').limitToLast(15).on('value', s => {
                const box = document.getElementById('adm-log-box');
                if(!box) return;
                box.innerHTML = '';
                s.forEach(l => {
                    box.innerHTML += `<div class="log-line log-alert">[!] VIOLATION: ${l.val().name} -> ${l.val().reason}</div>`;
                });
            });
        }

        // Listen for system messages
        db.ref('system/broadcast').on('value', s => {
            const v = s.val();
            if(v && Date.now() - v.time < 10000) tg.showPopup({ title: "ROOT_SYSTEM", message: v.msg });
        });

        function closeP() { document.getElementById('master-modal').style.display = 'none'; }
    </script>
</body>
</html>
