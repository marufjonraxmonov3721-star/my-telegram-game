<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Raxmonov Gold: Emperor Edition</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root { --gold: #ffd700; --bg: #0b0e11; --card: #1c2127; --green: #27ae60; --red: #e74c3c; }
        body { background-color: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; user-select: none; }
        
        /* Stats */
        .header { margin-top: 20px; text-align: center; }
        #score { font-size: 48px; font-weight: 900; color: var(--gold); text-shadow: 0 0 20px rgba(255, 215, 0, 0.4); margin: 0; }
        .league-badge { font-size: 11px; background: var(--green); padding: 3px 15px; border-radius: 20px; font-weight: bold; }

        /* Game Area */
        .game-area { flex-grow: 1; display: flex; align-items: center; justify-content: center; width: 100%; position: relative; }
        .coin-btn { width: 220px; height: 220px; background: radial-gradient(circle, #ffe066, #b8860b); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 110px; cursor: pointer; box-shadow: 0 0 50px rgba(255, 215, 0, 0.3); border: 8px solid #ffd700; transition: transform 0.05s; }
        .coin-btn:active { transform: scale(0.92); }

        /* Nav */
        .bottom-nav { width: 100%; background: var(--card); border-radius: 25px 25px 0 0; padding: 15px 0; display: grid; grid-template-columns: repeat(5, 1fr); border-top: 2px solid #333; }
        .nav-item { text-align: center; cursor: pointer; }
        .nav-item b { font-size: 11px; color: var(--gold); display: block; }

        /* Admin Tag */
        .admin-tag { position: fixed; top: 10px; right: 10px; background: var(--red); font-size: 10px; padding: 6px 12px; border-radius: 8px; display: none; cursor: pointer; z-index: 1001; font-weight: bold; }

        /* Modals */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.98); display: none; flex-direction: column; align-items: center; z-index: 1000; padding: 20px 0; }
        .content-box { width: 90%; background: var(--card); border-radius: 15px; padding: 15px; overflow-y: auto; flex-grow: 1; margin-bottom: 20px; }
        .close-btn { background: #555; border: none; padding: 12px 40px; border-radius: 10px; color: white; font-weight: bold; }
        
        /* Admin UI */
        .admin-section { border: 1px solid #444; padding: 10px; border-radius: 10px; margin-bottom: 15px; background: rgba(255,255,255,0.03); }
        .admin-section h4 { margin: 0 0 10px 0; color: var(--gold); font-size: 14px; }
        input { width: 100%; padding: 10px; margin-bottom: 8px; background: #000; border: 1px solid #444; color: #fff; border-radius: 8px; box-sizing: border-box; }
        .btn-small { background: var(--gold); color: #000; border: none; padding: 8px; border-radius: 5px; font-weight: bold; width: 100%; cursor: pointer; margin-bottom: 5px; }
        .btn-red { background: var(--red); color: #fff; }
    </style>
</head>
<body>

    <div id="admin-access" class="admin-tag" onclick="openPanel('admin')">‚öôÔ∏è EMPEROR PANEL</div>

    <div class="header">
        <div id="league" class="league-badge">Bronze League</div>
        <h1 id="score">0</h1>
        <div style="font-size: 10px; color: var(--green); margin-top: 5px;">‚óè <span id="online-users">1</span> Online</div>
    </div>

    <div class="game-area">
        <div class="coin-btn" id="tapBtn">ü™ô</div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item" onclick="openPanel('shop')"><b>Mining</b></div>
        <div class="nav-item" onclick="openPanel('chat')"><b>Chat</b></div>
        <div class="nav-item" onclick="openPanel('wheel')"><b>Wheel</b></div>
        <div class="nav-item" onclick="openPanel('rank')"><b>Top</b></div>
        <div class="nav-item" onclick="claimDaily()"><b>Bonus</b></div>
    </div>

    <div id="overlay" class="overlay">
        <h2 id="panel-title" style="color: var(--gold);">Sarlavha</h2>
        <div class="content-box" id="panel-content"></div>
        <button class="close-btn" onclick="closePanel()">Yopish</button>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBc7tUey3q6hGZjWxisJo701-G4NbyD9zI",
            authDomain: "gen-lang-client-0228947349.firebaseapp.com",
            projectId: "gen-lang-client-0228947349",
            databaseURL: "https://gen-lang-client-0228947349-default-rtdb.firebaseio.com",
            storageBucket: "gen-lang-client-0228947349.firebasestorage.app",
            messagingSenderId: "253793341504",
            appId: "1:253793341504:web:709752258000dab44fcfa5"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const tg = window.Telegram.WebApp;
        tg.expand();

        const ADMIN_ID = 7385372033; 
        const user = tg.initDataUnsafe?.user || { id: "dev_test", first_name: "O'yinchi" };
        const userRef = db.ref('users/' + user.id);
        
        let score = 0, autoLevel = 0, lastWheel = 0, isBanned = false;

        if(user.id == ADMIN_ID) document.getElementById('admin-access').style.display = 'block';

        // Online Status
        db.ref('online/' + user.id).set(true);
        db.ref('online/' + user.id).onDisconnect().remove();
        db.ref('online').on('value', s => document.getElementById('online-users').innerText = s.numChildren());

        // Maintenance Check
        db.ref('settings/maintenance').on('value', s => {
            if(s.val() && user.id != ADMIN_ID) {
                document.body.innerHTML = "<div style='padding:50px; text-align:center;'><h1>üõ† Texnik ishlar</h1><p>O'yin tez orada qaytadi!</p></div>";
            }
        });

        // Data Sync
        userRef.on('value', (snap) => {
            const data = snap.val();
            if(data) {
                if(data.banned) {
                    document.body.innerHTML = "<h1 style='color:red; text-align:center; margin-top:100px;'>Siz bloklangansiz!</h1>";
                    return;
                }
                score = data.score || 0;
                autoLevel = data.autoLevel || 0;
                lastWheel = data.lastWheel || 0;
                updateUI();
            } else {
                userRef.set({ name: user.first_name, score: 0, autoLevel: 0 });
            }
        });

        document.getElementById('tapBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            score += 1;
            userRef.update({ score: score });
            if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
        });

        function updateUI() {
            document.getElementById('score').innerText = Math.floor(score).toLocaleString();
        }

        function openPanel(type) {
            const overlay = document.getElementById('overlay');
            const content = document.getElementById('panel-content');
            overlay.style.display = 'flex';
            content.innerHTML = '';

            if(type === 'admin') {
                document.getElementById('panel-title').innerText = "Imperator Paneli";
                content.innerHTML = `
                    <div class="admin-section">
                        <h4>üì¢ Global Bildirishnoma</h4>
                        <input id="admMsg" placeholder="Xabar matni...">
                        <button class="btn-small" onclick="sendGlobalMsg()">Xabarni yuborish</button>
                    </div>

                    <div class="admin-section">
                        <h4>üë§ Foydalanuvchini boshqarish</h4>
                        <input id="targetId" placeholder="User ID (masalan: 12345)">
                        <button class="btn-small" onclick="manageUser('bonus')">+100K Bonus berish</button>
                        <button class="btn-small btn-red" onclick="manageUser('ban')">Bloklash / Ochish</button>
                        <button class="btn-small btn-red" onclick="manageUser('reset')">Ballarini nol qilish</button>
                    </div>

                    <div class="admin-section">
                        <h4>üåç Global Sozlamalar</h4>
                        <button class="btn-small btn-red" onclick="toggleMaintenance()">Maintenance Mode (ON/OFF)</button>
                        <button class="btn-small btn-red" style="margin-top:10px" onclick="globalReset()">SEASON RESET (HAMMANI NOL QILISH)</button>
                    </div>
                `;
            } else {
                content.innerHTML = "<p style='text-align:center'>Yuklanmoqda...</p>";
                // Boshqa panellar kodi shu yerda bo'ladi...
            }
        }

        // --- ADMIN FUNCTIONS ---

        function sendGlobalMsg() {
            const t = document.getElementById('admMsg').value;
            if(t) db.ref('global_notification').set({ text: t, time: Date.now() });
        }

        function manageUser(action) {
            const id = document.getElementById('targetId').value;
            if(!id) return tg.showAlert("ID kiriting!");
            const ref = db.ref('users/' + id);

            ref.once('value', s => {
                if(!s.exists()) return tg.showAlert("Foydalanuvchi topilmadi!");
                
                if(action === 'bonus') ref.update({ score: (s.val().score || 0) + 100000 });
                if(action === 'ban') ref.update({ banned: !s.val().banned });
                if(action === 'reset') ref.update({ score: 0 });
                
                tg.showAlert("Amal bajarildi!");
            });
        }

        function toggleMaintenance() {
            db.ref('settings/maintenance').once('value', s => {
                db.ref('settings/maintenance').set(!s.val());
                tg.showAlert("Texnik holat o'zgardi!");
            });
        }

        function globalReset() {
            tg.showConfirm("DIQQAT! Hamma o'yinchilarning ballarini nolga tushirmoqchimisiz?", (confirm) => {
                if(confirm) {
                    db.ref('users').once('value', snap => {
                        const updates = {};
                        snap.forEach(c => { updates[c.key + '/score'] = 0; });
                        db.ref('users').update(updates);
                        tg.showAlert("Season Reset tugatildi!");
                    });
                }
            });
        }

        db.ref('global_notification').on('value', s => {
            const d = s.val();
            if(d && Date.now() - d.time < 30000) tg.showPopup({ title: "üì¢ ADMIN", message: d.text, buttons: [{type: "ok"}] });
        });

        function closePanel() { document.getElementById('overlay').style.display = 'none'; }
    </script>
</body>
</html>
