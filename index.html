<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Telegram AI Clicker</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        body {
            background-color: #0b0e11;
            color: white;
            font-family: 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            user-select: none;
            touch-action: manipulation;
        }

        .stats-container { margin-top: 40px; text-align: center; }
        #score { font-size: 50px; font-weight: 800; color: #f39c12; text-shadow: 0 0 20px rgba(243, 156, 18, 0.4); }

        .coin-btn {
            margin-top: 30px;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, #f39c12 0%, #d35400 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            cursor: pointer;
            box-shadow: 0 10px 0 #a04000, 0 15px 25px rgba(0,0,0,0.5);
            transition: transform 0.05s;
            border: 8px solid #e67e22;
        }
        .coin-btn:active { transform: translateY(5px) scale(0.95); box-shadow: 0 5px 0 #a04000; }

        .leaderboard {
            width: 90%;
            margin-top: 30px;
            background: #1c2127;
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 50px;
            border: 1px solid #2c3e50;
        }

        .player-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 10px;
            border-bottom: 1px solid #2c3e50;
        }
        .player-row:last-child { border: none; }

        .rank-box { width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px; margin-right: 10px; }
        .gold, .silver, .bronze { font-size: 22px; }
        .normal-rank { color: #7f8c8d; font-size: 16px; }

        .player-info { display: flex; align-items: center; }
        .player-name { font-size: 14px; font-weight: 500; color: #ecf0f1; }
        
        /* Faqat Telegramda ishlashi uchun ogohlantirish */
        #only-tg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0b0e11; display: none; align-items: center; justify-content: center; z-index: 1000; text-align: center; padding: 20px; }
    </style>
</head>
<body>

    <div id="only-tg">
        <h2>Iltimos, o'yinni Telegram orqali oching! üöÄ</h2>
    </div>

    <div class="stats-container">
        <div style="font-size: 12px; color: #7f8c8d; letter-spacing: 1px; text-transform: uppercase;">Balans</div>
        <div id="score">0</div>
    </div>

    <div class="coin-btn" id="tapBtn">ü™ô</div>

    <div class="leaderboard">
        <h3 style="margin-top: 0; text-align: center; font-size: 16px; color: #f39c12;">üèÜ REYTING (FAQAT TELEGRAM)</h3>
        <div id="leaderboard-list">Yuklanmoqda...</div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBc7tUey3q6hGZjWxisJo701-G4NbyD9zI",
            authDomain: "gen-lang-client-0228947349.firebaseapp.com",
            projectId: "gen-lang-client-0228947349",
            databaseURL: "https://gen-lang-client-0228947349-default-rtdb.firebaseio.com",
            storageBucket: "gen-lang-client-0228947349.firebasestorage.app",
            messagingSenderId: "253793341504",
            appId: "1:253793341504:web:709752258000dab44fcfa5"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const tg = window.Telegram.WebApp;
        tg.expand();

        // MUHIM: Faqat Telegram foydalanuvchilarini tekshirish
        const user = tg.initDataUnsafe?.user;
        
        if (!user || !user.id) {
            // Agar Telegramdan kirmagan bo'lsa, o'yinni ko'rsatmaymiz
            document.getElementById('only-tg').style.display = 'flex';
        } else {
            const userId = user.id;
            const userName = user.first_name + (user.last_name ? " " + user.last_name : "");
            
            let score = 0;
            const scoreEl = document.getElementById('score');
            const userRef = db.ref('users/' + userId);

            // Foydalanuvchi ma'lumotlarini yuklash
            userRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    score = data.score;
                    scoreEl.innerText = score.toLocaleString();
                    // Ismi o'zgargan bo'lsa, bazada yangilab qo'yamiz
                    if (data.name !== userName) {
                        userRef.update({ name: userName });
                    }
                } else {
                    userRef.set({ name: userName, score: 0 });
                }
            });

            // Tap funksiyasi
            document.getElementById('tapBtn').addEventListener('click', () => {
                score++;
                scoreEl.innerText = score.toLocaleString();
                userRef.update({ score: score });
                if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('medium');
            });
        }

        // Reytingni ko'rsatish (Hamma uchun ko'rinadi, lekin faqat TGdagilar yoziladi)
        const leaderboardRef = db.ref('users').orderByChild('score').limitToLast(10);
        leaderboardRef.on('value', (snapshot) => {
            const list = document.getElementById('leaderboard-list');
            list.innerHTML = '';
            let players = [];
            
            snapshot.forEach(child => { players.push(child.val()); });
            players.reverse().forEach((player, index) => {
                let rankNum = index + 1;
                let rankHTML = '';

                if (rankNum === 1) rankHTML = '<div class="rank-box gold">ü•á</div>';
                else if (rankNum === 2) rankHTML = '<div class="rank-box silver">ü•à</div>';
                else if (rankNum === 3) rankHTML = '<div class="rank-box bronze">ü•â</div>';
                else rankHTML = `<div class="rank-box normal-rank">${rankNum}</div>`;
                
                list.innerHTML += `
                    <div class="player-row">
                        <div class="player-info">
                            ${rankHTML}
                            <span class="player-name">${player.name}</span>
                        </div>
                        <span style="font-weight: bold; color: #f39c12;">${player.score.toLocaleString()}</span>
                    </div>`;
            });
        });
    </script>
</body>
</html>
