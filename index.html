<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Clicker Pro: Boost & Daily</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        body { background-color: #0b0e11; color: white; font-family: sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; user-select: none; }
        
        /* Stats */
        .header { margin-top: 20px; text-align: center; }
        #score { font-size: 45px; font-weight: bold; color: #f39c12; }
        .energy-bar { width: 80%; background: #2c3e50; height: 10px; border-radius: 5px; margin-top: 10px; overflow: hidden; }
        #energy-fill { width: 100%; height: 100%; background: #27ae60; transition: width 0.3s; }
        
        /* Coin */
        .coin-btn { margin-top: 30px; width: 180px; height: 180px; background: radial-gradient(circle, #f39c12, #d35400); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 70px; cursor: pointer; box-shadow: 0 10px 0 #a04000; border: 6px solid #e67e22; }
        .coin-btn:active { transform: translateY(5px); box-shadow: 0 5px 0 #a04000; }

        /* Boosters & Daily */
        .menu-container { width: 90%; margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .menu-card { background: #1c2127; padding: 15px; border-radius: 15px; text-align: center; border: 1px solid #333; }
        .btn-buy { background: #f39c12; color: black; border: none; padding: 8px; border-radius: 8px; font-weight: bold; margin-top: 10px; width: 100%; }
        
        .leaderboard { width: 90%; margin-top: 20px; background: #1c2127; border-radius: 15px; padding: 15px; margin-bottom: 30px; }
        .player-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #2c3e50; font-size: 14px; }
    </style>
</head>
<body>

    <div class="header">
        <div id="score">0</div>
        <div style="font-size: 12px; color: #7f8c8d;">Energiya: <span id="energy-text">1000/1000</span></div>
        <div class="energy-bar"><div id="energy-fill"></div></div>
    </div>

    <div class="coin-btn" id="tapBtn">ü™ô</div>

    <div class="menu-container">
        <div class="menu-card">
            <div style="font-size: 12px;">Daily Reward</div>
            <div id="daily-status" style="font-weight: bold; color: #27ae60;">Tayyor!</div>
            <button class="btn-buy" onclick="claimDaily()">Olish</button>
        </div>
        <div class="menu-card">
            <div style="font-size: 12px;">Multi-tap</div>
            <div id="multi-level" style="font-weight: bold;">Lvl 1</div>
            <button class="btn-buy" id="upgradeBtn">Lv Up: 500</button>
        </div>
    </div>

    <div class="leaderboard">
        <h3 style="margin: 0 0 10px 0; font-size: 16px; text-align: center;">üèÜ TOP REYTING</h3>
        <div id="leaderboard-list"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBc7tUey3q6hGZjWxisJo701-G4NbyD9zI",
            authDomain: "gen-lang-client-0228947349.firebaseapp.com",
            projectId: "gen-lang-client-0228947349",
            databaseURL: "https://gen-lang-client-0228947349-default-rtdb.firebaseio.com",
            storageBucket: "gen-lang-client-0228947349.firebasestorage.app",
            messagingSenderId: "253793341504",
            appId: "1:253793341504:web:709752258000dab44fcfa5"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const tg = window.Telegram.WebApp;
        tg.expand();

        const user = tg.initDataUnsafe?.user || { id: "test_user", first_name: "O'yinchi" };
        const userId = user.id;
        const userRef = db.ref('users/' + userId);

        let score = 0, multi = 1, energy = 1000, maxEnergy = 1000, lastDaily = 0;

        // Ma'lumotlarni yuklash
        userRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                score = data.score || 0;
                multi = data.multi || 1;
                energy = data.energy !== undefined ? data.energy : 1000;
                lastDaily = data.lastDaily || 0;
                
                document.getElementById('score').innerText = score.toLocaleString();
                document.getElementById('multi-level').innerText = "Lvl " + multi + " (+" + multi + ")";
                document.getElementById('upgradeBtn').innerText = "Lv Up: " + (multi * 1000);
                updateEnergyUI();
                checkDailyStatus();
            } else {
                userRef.set({ name: user.first_name, score: 0, multi: 1, energy: 1000, lastDaily: 0 });
            }
        });

        // Tap funksiyasi
        document.getElementById('tapBtn').addEventListener('click', () => {
            if (energy >= multi) {
                score += multi;
                energy -= multi;
                userRef.update({ score: score, energy: energy });
                if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
            } else {
                if (tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('error');
            }
        });

        // Upgrade funksiyasi
        document.getElementById('upgradeBtn').addEventListener('click', () => {
            let cost = multi * 1000;
            if (score >= cost) {
                score -= cost;
                multi += 1;
                userRef.update({ score: score, multi: multi });
            }
        });

        // Daily Reward
        function checkDailyStatus() {
            const now = Date.now();
            const hoursLeft = (lastDaily + 86400000 - now) / 3600000;
            if (hoursLeft > 0) {
                document.getElementById('daily-status').innerText = Math.ceil(hoursLeft) + " soat";
            } else {
                document.getElementById('daily-status').innerText = "Tayyor!";
            }
        }

        function claimDaily() {
            const now = Date.now();
            if (now > lastDaily + 86400000) {
                score += 5000; // Har kunlik sobit bonus
                userRef.update({ score: score, lastDaily: now });
                alert("Tabriklaymiz! 5,000 bonus olindi.");
            } else {
                alert("Bonusni olish uchun hali vaqt bor.");
            }
        }

        // Energy tiklanishi (har 3 soniyada 10 energiya)
        setInterval(() => {
            if (energy < maxEnergy) {
                energy = Math.min(maxEnergy, energy + 5);
                userRef.update({ energy: energy });
                updateEnergyUI();
            }
        }, 3000);

        function updateEnergyUI() {
            document.getElementById('energy-text').innerText = energy + "/" + maxEnergy;
            document.getElementById('energy-fill').style.width = (energy / maxEnergy * 100) + "%";
        }

        // Reyting
        db.ref('users').orderByChild('score').limitToLast(10).on('value', (snapshot) => {
            const list = document.getElementById('leaderboard-list');
            list.innerHTML = '';
            let players = [];
            snapshot.forEach(child => { players.push(child.val()); });
            players.reverse().forEach((p, i) => {
                list.innerHTML += `<div class="player-row"><span>${i+1}. ${p.name}</span><b>${p.score.toLocaleString()}</b></div>`;
            });
        });
    </script>
</body>
</html>
