<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Empire Conquest Elite</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-gold: #ffcc00;
            --neon-red: #ff3366;
            --neon-green: #00ffcc;
            --bg-deep: #050508;
            --card-glass: rgba(20, 20, 30, 0.8);
            --border-glass: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            background: var(--bg-deep);
            color: white;
            font-family: 'Exo 2', sans-serif;
            overflow: hidden;
            background-image: radial-gradient(circle at 50% 50%, rgba(255, 204, 0, 0.05) 0%, transparent 50%);
        }

        .top-panel {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            padding: 15px 5px;
            background: rgba(10, 10, 15, 0.95);
            border-bottom: 1px solid var(--border-glass);
            backdrop-filter: blur(10px);
            position: fixed; top: 0; width: 100%; z-index: 1000;
        }

        .stat-item { text-align: center; position: relative; }
        .stat-label { font-size: 0.6rem; color: #888; text-transform: uppercase; font-family: 'Orbitron'; }
        .stat-value { font-size: 1.1rem; font-weight: 900; color: var(--neon-gold); display: block; }

        .page {
            display: none;
            height: 100vh;
            padding: 90px 20px 100px 20px;
            overflow-y: auto;
            animation: fadeIn 0.4s ease;
        }

        .active-page { display: flex; flex-direction: column; align-items: center; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .hero-base { flex: 1; display: flex; align-items: center; justify-content: center; width: 100%; }
        .base-core {
            width: 160px; height: 160px;
            background: linear-gradient(135deg, #1a1a2e, #0f3460);
            border-radius: 40px; border: 2px solid var(--neon-green);
            display: flex; align-items: center; justify-content: center;
            animation: float 4s infinite ease-in-out;
            box-shadow: 0 0 30px rgba(0, 255, 204, 0.2);
        }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

        .controls-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 450px; }
        .action-btn {
            background: var(--card-glass); border: 1px solid var(--border-glass);
            border-radius: 20px; padding: 15px; color: white; text-align: center;
        }

        .attack-bar {
            grid-column: span 2; background: linear-gradient(90deg, #ff3366, #ff6633);
            border: none; padding: 18px; border-radius: 20px; font-family: 'Orbitron'; font-weight: 900;
        }

        .list-container { width: 100%; background: var(--card-glass); border-radius: 25px; border: 1px solid var(--border-glass); }
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid var(--border-glass); }

        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; height: 75px;
            background: rgba(10, 10, 15, 0.98); display: flex;
            justify-content: space-around; align-items: center; border-top: 1px solid var(--border-glass);
        }

        .nav-link { display: flex; flex-direction: column; align-items: center; color: #555; font-size: 0.7rem; }
        .nav-link.active { color: var(--neon-gold); }
    </style>
</head>
<body>

    <div class="top-panel">
        <div class="stat-item"><span class="stat-label">Oltin</span><span class="stat-value" id="gold-ui">0</span></div>
        <div class="stat-item"><span class="stat-label">Daq/s</span><span class="stat-value" id="prod-ui">0</span></div>
        <div class="stat-item"><span class="stat-label">Armiya</span><span class="stat-value" id="army-ui">0</span></div>
    </div>

    <div id="p-home" class="page active-page">
        <div class="hero-base"><div class="base-core"><i class="material-icons" style="font-size:5rem; color:var(--neon-green)">castle</i></div></div>
        <div class="controls-grid">
            <div class="action-btn" onclick="upgrade('prod')"><i class="material-icons">precision_manufacturing</i><br>Zavod<br><span id="p-cost-ui" style="color:var(--neon-green)">100</span></div>
            <div class="action-btn" onclick="upgrade('army')"><i class="material-icons">military_tech</i><br>Armiya<br><span id="a-cost-ui" style="color:var(--neon-green)">200</span></div>
            <button class="action-btn attack-bar" onclick="switchPage('p-war', document.getElementById('nav-war'))">HUJUMGA O'TISH</button>
        </div>
    </div>

    <div id="p-war" class="page"><h2 style="font-family:'Orbitron'; color:var(--neon-red)">ZONE</h2><div class="list-container" id="war-list"></div></div>
    <div id="p-top" class="page"><h2 style="font-family:'Orbitron'; color:var(--neon-gold)">TOP</h2><div class="list-container" id="top-list"></div></div>

    <nav class="bottom-nav">
        <div class="nav-link active" id="nav-home" onclick="switchPage('p-home', this)"><i class="material-icons">dashboard</i><span>BAZA</span></div>
        <div class="nav-link" id="nav-war" onclick="switchPage('p-war', this)"><i class="material-icons">rocket_launch</i><span>URUSH</span></div>
        <div class="nav-link" id="nav-top" onclick="switchPage('p-top', this)"><i class="material-icons">emoji_events</i><span>TOP</span></div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, query, orderBy, limit, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBcP_98nEk4HxZpuh_XQoAB7MRvJbkIORc",
            authDomain: "ilova-79e22.firebaseapp.com",
            projectId: "ilova-79e22",
            storageBucket: "ilova-79e22.firebasestorage.app",
            messagingSenderId: "1084364864104",
            appId: "1:1084364864104:web:4c12398e4dd6e5978ad9dd"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const tg = window.Telegram.WebApp;
        tg.expand();

        let state = { gold: 500, prod: 5, army: 100, pCost: 100, aCost: 200, name: tg.initDataUnsafe?.user?.first_name || "Lider" };
        const uid = tg.initDataUnsafe?.user?.id?.toString() || "dev_user";

        window.switchPage = (id, el) => {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active-page'));
            document.getElementById(id).classList.add('active-page');
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        };

        function refreshUI() {
            document.getElementById('gold-ui').innerText = Math.floor(state.gold).toLocaleString();
            document.getElementById('prod-ui').innerText = state.prod;
            document.getElementById('army-ui').innerText = state.army;
            document.getElementById('p-cost-ui').innerText = state.pCost;
            document.getElementById('a-cost-ui').innerText = state.aCost;
        }

        async function init() {
            const userRef = doc(db, "empire_pro", uid);
            const snap = await getDoc(userRef);
            if (!snap.exists()) await setDoc(userRef, state);
            else state = { ...state, ...snap.data() };
            refreshUI();
            
            setInterval(async () => {
                state.gold += (state.prod / 5);
                refreshUI();
                if (Math.random() > 0.98) await updateDoc(userRef, { gold: state.gold });
            }, 200);
        }

        window.upgrade = async (type) => {
            if (type === 'prod' && state.gold >= state.pCost) {
                state.gold -= state.pCost; state.prod += 5; state.pCost *= 2;
            } else if (type === 'army' && state.gold >= state.aCost) {
                state.gold -= state.aCost; state.army += 25; state.aCost *= 2;
            } else return;
            refreshUI();
            await updateDoc(doc(db, "empire_pro", uid), state);
        };

        onSnapshot(query(collection(db, "empire_pro"), orderBy("gold", "desc"), limit(15)), (snap) => {
            const top = document.getElementById('top-list');
            const war = document.getElementById('war-list');
            top.innerHTML = ""; war.innerHTML = "";
            snap.forEach(d => {
                const p = d.data();
                top.innerHTML += `<div class="list-item"><span>${p.name}</span><span style="color:var(--neon-gold)">ðŸ’° ${Math.floor(p.gold)}</span></div>`;
                if(d.id !== uid) {
                    war.innerHTML += `<div class="list-item"><span>${p.name} (ðŸŽ–${p.army})</span><button onclick="attack('${d.id}', ${p.army})" style="background:none; border:1px solid var(--neon-red); color:white; border-radius:10px; padding:5px 10px;">URUSH</button></div>`;
                }
            });
        });

        window.attack = async (tid, tarmy) => {
            tg.showConfirm("Hujum qilasizmi?", async (ok) => {
                if(ok) {
                    if(state.army > tarmy) {
                        state.gold += 1000; state.army -= 20;
                        tg.showAlert("G'alaba! +1,000 oltin");
                    } else {
                        state.army = 10;
                        tg.showAlert("Mag'lubiyat!");
                    }
                    await updateDoc(doc(db, "empire_pro", uid), state);
                    refreshUI();
                }
            });
        };

        init();
    </script>
</body>
</html>

